name: release

on:
  push:
    tags:
      - '*'

jobs:
  publish-nuget:
    runs-on: ubuntu-18.04
    env:
      NUGET_API_KEY: ${{ secrets.NUGET_API_KEY }}
    steps:
    - uses: actions/checkout@v2

    - name: Build Powershell Module
      run: make build_powershell

    - uses: actions/upload-artifact@v2
      with:
        name: PSc8y
        path: tools/PSc8y/dist/PSc8y.zip

    - name: Publish Powershell Module (PSc8y)
      run: make publish


  publish-docker-latest:
    runs-on: ubuntu-latest
    if: "false"

    steps:
    - uses: actions/checkout@v2 # Checking out the repo

    - name: Build docker images
      run: |
        TAG_PREFIX="ghcr.io/${GITHUB_REPOSITORY}/"
        make TAG_PREFIX=$TAG_PREFIX build_docker

    - name: Publish c8ycli pwsh docker image
      uses: VaultVulp/gp-docker-action@1.0.1
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        image-name: c8ycli-pwsh
        # extract-git-tag: true

    - name: Publish c8ycli zsh docker image
      uses: VaultVulp/gp-docker-action@1.0.1
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        image-name: c8ycli-zsh
        # extract-git-tag: true

    - name: Publish c8ycli bash docker image
      uses: VaultVulp/gp-docker-action@1.0.1
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        image-name: c8ycli-bash
        # extract-git-tag: true