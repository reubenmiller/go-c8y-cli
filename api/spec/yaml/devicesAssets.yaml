# yaml-language-server: $schema=../schema.json
---
information:
  name: devices/assets
  description: Cumulocity device assets
  descriptionLong: "REST endpoint to interact with Cumulocity device assets"
  link: https://cumulocity.com/guides/reference/inventory/

endpoints:
  - name: newManagedObjectChildAsset
    method: POST
    path: inventory/managedObjects/{device}/childAssets
    accept: application/vnd.com.nsn.cumulocity.managedObjectReference+json
    collectionType: application/vnd.com.nsn.cumulocity.managedObject+json
    description: Assign child asset
    descriptionLong: "Create a child asset reference to an existing device"
    collectionProperty: managedObject
    alias:
      go: assign
      powershell: Add-ChildDeviceToDevice
    examples:
      powershell:
        - description: Assign a managed object as a child asset to an existing device
          beforeEach:
            - $Device = PSc8y\New-TestDevice
            - $ChildDevice = PSc8y\New-TestDevice
          command: Add-ChildDeviceToDevice -Device $Device.id -Child $ChildDevice.id
          afterEach:
            - PSc8y\Remove-ManagedObject -Id $ChildDevice.id
            - PSc8y\Remove-ManagedObject -Id $Device.id

        - description: Assign a managed object as a child asset to an existing device (using pipeline)
          beforeEach:
            - $Device = PSc8y\New-TestDevice
            - $ChildDevice = PSc8y\New-TestDevice
          command: Get-ManagedObject -Id $ChildDevice.id | Add-ChildDeviceToDevice -Device $Device.id
          afterEach:
            - PSc8y\Remove-ManagedObject -Id $Device.id
            - PSc8y\Remove-ManagedObject -Id $ChildDevice.id

      go:
        - description: Assign a managed object as a child asset to an existing device
          command: c8y devices assets assign --device 12345 --child 44235
    pathParameters:
      - name: device
        type: "[]device"
        required: true
        description: Device.
    body:
      - name: child
        type: "[]device"
        required: true
        pipeline: true
        property: "managedObject.id"
        description: New child asset

  - name: deleteManagedObjectChildAssetReference
    description: Delete child asset reference
    descriptionLong: Delete child asset reference
    method: DELETE
    path: inventory/managedObjects/{device}/childAssets/{child}
    accept: ""
    alias:
      go: unassign
      powershell: Remove-ChildDeviceFromDevice
    examples:
      powershell:
        - description: Unassign a child device from its parent device
          beforeEach:
            - $Device = PSc8y\New-TestDevice
            - $ChildDevice = PSc8y\New-TestDevice
            - PSc8y\Add-ChildDeviceToDevice -Device $Device.id -Child $ChildDevice.id
          command: Remove-ChildDeviceFromDevice -Device $Device.id -ChildDevice $ChildDevice.id
          afterEach:
            - PSc8y\Remove-ManagedObject -Id $ChildDevice.id
            - PSc8y\Remove-ManagedObject -Id $Device.id

      go:
        - description: Unassign a child device from its parent device
          command: c8y devices assets unassign --device 12345 --child 22553
    pathParameters:
      - name: device
        type: "[]device"
        required: true
        description: ManagedObject id

      - name: child
        type: "[]device"
        required: true
        pipeline: true
        description: Child asset reference

  - name: getManagedObjectChildAssetReference
    description: Get child asset reference
    descriptionLong: Get managed object child device reference
    method: GET
    path: inventory/managedObjects/{device}/childAssets/{child}
    accept: application/vnd.com.nsn.cumulocity.managedObjectReference+json
    alias:
      go: get
      powershell: Get-DeviceChildAsset
    examples:
      powershell:
        - description: Get an existing child device reference
          beforeEach:
            - $Agent = New-TestAgent
            - $Device = New-TestDevice
            - $Ref = Add-ChildAssetToManagedObject -Id $agent.id -ChildDevice $Device.id
          command: Get-DeviceChildAsset -Device $Agent.id -Child $Ref.id
          afterEach:
            - Remove-ManagedObject -Id $Device.id
            - Remove-ManagedObject -Id $Agent.id
      go:
        - description: Get an existing child device reference
          command: c8y devices assets get --device 12345 --child 12345
    pathParameters:
      - name: device
        type: "[]device"
        pipeline: true
        required: true
        description: ManagedObject id

      - name: child
        type: "[]device"
        required: true
        description: Device reference id

  - name: listChildAssetCollection
    method: GET
    description: Get child asset collection
    descriptionLong: Get a collection of managedObjects child references
    path: inventory/managedObjects/{device}/childAssets
    accept: application/vnd.com.nsn.cumulocity.managedObjectReferenceCollection+json
    collectionType: application/vnd.com.nsn.cumulocity.managedObject+json
    collectionProperty: "references.#.managedObject"
    alias:
      go: list
      powershell: Get-DeviceChildAssetCollection
    examples:
      powershell:
        - description: Get a list of the child assets of an existing device
          command: Get-DeviceChildAssetCollection -Device agentAssetInfo01

        - description: List child assets of a device but filter the children using a custom query
          command: |
            Get-Device -Id "agentAssetInfo01" | Get-DeviceChildAssetCollection -Query "type eq 'custom*'"

      go:
        - description: Get a list of the child assets of an existing device
          command: c8y devices assets list --device 12345

        - description: List child assets of a device but filter the children using a custom query
          command: echo agentAssetInfo01 | c8y devices assets list --query "type eq 'custom*'"
          assertStdOut:
            json:
                method: GET
                path: r//inventory/managedObjects/\d+/childAssets
    pathParameters:
      - name: device
        type: "[]device"
        pipeline: true
        required: true
        description: Device.

    queryParameters:
      - name: query
        description: Query expression group
        property: query
        type: queryExpression
        children:
          - name: query
            type: string
            description: Additional query filter
            format: (%s)
          
          - name: queryTemplate
            type: string
            description: String template to be used when applying the given query. Use %s to reference the query/pipeline input
          
          - name: orderBy
            type: string
            description: Order by. e.g. _id asc or name asc or creationTime.date desc

      - name: withChildren
        type: boolean
        description: Determines if children with ID and name should be returned when fetching the managed object.
